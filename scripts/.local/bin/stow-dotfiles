#!/usr/bin/env zsh

source $DOTFILES/install/setup_utils.sh

fail() {
    _alert_local $1 1
    exit 11
}

ignore_files=".git install misc"
app=$1
op=${2:-"stow"}
src=$DOTFILES
tgt=$HOME

appPath=$src/$app
[ ! -d "$appPath" ] && fail "dotfiles for $app not found"

# Ignore apps
echo $ignore_files | grep -wq $app
[ "$?" -eq 0 ] && fail "cannot stow $app, it is in \$ignore_files"

case $op in
    stow) flag="--stow" ;;
    unstow) flag="--delete" ;;
    restow) flag="--restow" ;;
    *) ;;
esac

[ -z "$flag" ] && fail "Unknown operation"

# Link the first level of config files
stow -v $flag --dir=$src --target=$tgt --no-folding $app

unset app flag op src tgt appPath
