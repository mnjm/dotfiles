#!/usr/bin/env zsh

sessions=$(tmux list-session -F "#{session_name}" 2>/dev/null)
selected=$(echo $sessions | fzf --height 100% --reverse --no-multi --print-query \
    --preview "tmux capture-pane -pt {}" --preview-window right,90% | tail -n1)
if [[ -n $selected ]]; then
    if [ -z "$TMUX" ]; then
        tmux new -As $selected
    else
        if  ! tmux has-session -t $selected 2>/dev/null; then
            tmux new -ds $selected
        fi
        tmux switch-client -t $selected
    fi
fi
unset sessions selected
